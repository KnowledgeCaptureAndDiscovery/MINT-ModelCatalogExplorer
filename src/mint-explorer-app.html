<!--
The mint explorer app, which contains the pages for searching models,
viewing models, viewing model configuration, and viewing input and 
output presentations.s
-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="lazy-import" href="model-search.html">
<link rel="lazy-import" href="view-model.html">
<link rel="lazy-import" href="model-configuration.html">
<link rel="lazy-import" href="variable-configuration.html">
<link rel="lazy-import" href="not-found.html">

<link rel="import" href="/bower_components/app-layout/app-layout.html">
<link rel="import" href="/bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="/bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="/bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">
<link rel="import" href="/bower_components/neon-animation/web-animations.html">
<link rel="import" href="/bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/bower_components/iron-meta/iron-meta.html">
<link rel="import" href="my-icons.html">

<dom-module id="mint-explorer-app">
  <template>
    <style>
      html, body {
          margin: 0;
          font-family: 'Roboto', 'Noto', sans-serif;
          -webkit-font-smoothing: antialiased;
          max-height: 368px;
          background-color: #4285f4;
        }

        app-header-layout {
          margin: 10px;
          padding: 10px;
        }

        app-toolbar {
          background-color: #f2f1ed;
          color: #706f6d;
        }

    </style>

    <app-location
      route="{{route}}"
      url-space-regex="^[[rootPath]]">
    </app-location>

    <app-route
      route="{{route}}"
      pattern="[[rootPath]]:page"
      data="{{routeData}}"
      tail="{{subroute}}">
    </app-route>

    <app-header-layout>
      <app-header>
        <app-toolbar>
          <img height="40" src="images/logo.png">
          <div id="heading">MINT</div>
        </app-toolbar>
      </app-header>

      <!-- <dom-repeat items="{{modelDescriptions}}">
      	<template>
      		Query [[index]] - [[item.model]]
      	</template>
      </dom-repeat>  -->

      <iron-pages id="pages"
        selected="{{page}}"
        attr-for-selected="name"
        fallback-selection="not-found"
        role="main">
        <model-search id="modelSearch" name="model-search"></model-search>
        <view-model id="viewModel" name="view-model"></view-model>
        <model-configuration id="modelConfiguration" name="model-configuration"></model-configuration>
        <variable-configuration id="variableConfiguration" name="variable-configuration"></variable-configuration>
        <not-found name="not-found"></not-found>
      </iron-pages>

      
    </app-header-layout>
  </template>

  <script>
    // Gesture events like tap and track generated from touch will not be
    // preventable, allowing for better scrolling performance.
    Polymer.setPassiveTouchGestures(true);

    class MintExplorerApp extends Polymer.Element {
      static get is() { return 'mint-explorer-app'; }
      static get properties() {
        return {
          page: {
            type: String,
            reflectToAttribute: true,
            observer: '_pageChanged',
          },
          routeData: Object,
          subroute: Object,
          modelSelected: {
            model: String,
            label: String,
          },
          rootPath: String,
          configSelected: {
            model: String,
            config: Object
          },
          queries: Array,
          modelDescriptions: Array,
          endpoint: {
          	type: String,
          	value: "http://ontosoft.isi.edu:3030/ds"
          }
        };
      }

      static get observers() {
        return [
          '_routePageChanged(routeData.page)',
        ];
      }

      _routePageChanged(page) {
        // If no page was found in the route data, page will be an empty string.
        // Default to 'model-search' in that case.
        this.page = page || 'model-search';

      }

      _pageChanged(page) {
        // Load page import on demand. Show 404 page if fails
        const resolvedPageUrl = this.resolveUrl(page + '.html');
        Polymer.importHref(
            resolvedPageUrl,
            null,
            this._showPage404.bind(this),
            true);
      }

      _showPage404() {
        this.page = 'not-found';
      }

      ready() {
      	super.ready();
      	var _self = this;
      	// $.get("http://127.0.0.1:8080", {fileName: "queries.json"}, function(data){
      	// 	_self.queries = data;
       //  });
        $.ajax({
        	url: "http://127.0.0.1:8080",
        	type: "GET",
        	data: {fileName: "queries.json"},
        	async: false,
        	success: function(data) {
        		_self.queries = data;
        	}
        })
        // $.get("http://127.0.0.1:8080", {fileName: "model-descriptions.json"}, function(data){
      		// _self.modelDescriptions = data;
        // });
        $.ajax({
        	url: "http://127.0.0.1:8080",
        	type: "GET",
        	data: {fileName: "model-descriptions.json"},
        	async: false,
        	success: function(data) {
        		_self.modelDescriptions = data;
        	}
        })
      }

      // ready() {
      //   super.ready();
      //   var _self = this;
      //   $.ajax({
      //       url: "http://ontosoft.isi.edu:3030/ds/query?query=" + "PREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+model%3A+%3Chttps%3A%2F%2Fw3id.org%2Fmint%2FmodelCatalog%23%3E%0D%0ASELECT+%3Fmodel+%3Flabel%0D%0AWHERE+%7B%0D%0A++%3Fmodel+a+model%3AModel.%0D%0A++%3Fmodel+rdfs%3Alabel+%3Flabel%0D%0A%7D" +"&format=json",
      //       type: "GET",
      //       cache: false,
      //       timeout: 5000,
      //       async: true,
      //       complete: function() {
      //           console.log("GET request sent");
      //       },

      //       success: function(data) {
      //           console.log("GET success");    
      //           _self.models = data.results.bindings;
      //           console.log("From inside success function");
      //           console.log(_self.models);           
      //       },

      //       error: function(jqXHR, exception) {
      //           var msg = '';
      //           if (jqXHR.status === 0) {
      //               msg = 'Not connected.\n Verify Network.';
      //           } 
      //           else if (jqXHR.status == 404) {
      //               msg = 'Requested page not found. [404]';
      //           } 
      //           else if (jqXHR.status == 500) {
      //               msg = 'Internal Server Error [500].';
      //           } 
      //           else if (exception === 'parsererror') {
      //               msg = 'Requested JSON parse failed.';
      //           } 
      //           else if (exception === 'timeout') {
      //               msg = 'Time out error.';
      //           } 
      //           else if (exception === 'abort') {
      //               msg = 'Ajax request aborted.';
      //           } 
      //           else {
      //               msg = 'Uncaught Error.\n' + jqXHR.responseText;
      //           }
      //           console.log(msg);
      //       }
      //   });

      // }

    }

    window.customElements.define(MintExplorerApp.is, MintExplorerApp);
  </script>
</dom-module>
